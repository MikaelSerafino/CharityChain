<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Money Flow Tracker</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        max-width: 900px;
        margin: 30px auto;
        padding: 20px;
        background: #0a0e27;
        color: #fff;
      }
      .container {
        background: #1a1f3a;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }
      h1 {
        color: #00c077;
        margin-bottom: 10px;
      }
      h3 {
        color: #00e68a;
        margin-top: 25px;
        margin-bottom: 15px;
      }
      .info {
        background: rgba(0, 192, 119, 0.1);
        border-left: 4px solid #00c077;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
      }
      .warning {
        background: rgba(255, 152, 0, 0.1);
        border-left: 4px solid #ff9800;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
      }
      .error {
        background: rgba(244, 67, 54, 0.1);
        border-left: 4px solid #f44336;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
      }
      button {
        background: linear-gradient(135deg, #00c077, #00e68a);
        color: white;
        border: none;
        padding: 14px 28px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        margin: 5px;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 192, 119, 0.4);
      }
      input {
        width: 100%;
        padding: 12px;
        border: 2px solid #2a3f5f;
        border-radius: 8px;
        background: #0a0e27;
        color: white;
        font-size: 16px;
        margin: 10px 0;
        box-sizing: border-box;
      }
      .result {
        margin-top: 20px;
        padding: 15px;
        background: #0a0e27;
        border-radius: 8px;
        font-size: 14px;
        max-height: 600px;
        overflow-y: auto;
      }
      .flow-item {
        background: rgba(0, 192, 119, 0.05);
        border: 1px solid rgba(0, 192, 119, 0.2);
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
      }
      .money-flow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255, 255, 255, 0.03);
        padding: 12px;
        border-radius: 6px;
        margin: 8px 0;
      }
      .arrow {
        color: #00e68a;
        font-size: 24px;
        margin: 0 10px;
      }
      .address {
        font-family: "Courier New", monospace;
        background: rgba(0, 0, 0, 0.3);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        word-break: break-all;
      }
      .amount {
        color: #ffd700;
        font-size: 20px;
        font-weight: bold;
      }
      .success {
        color: #00e68a;
        font-weight: bold;
      }
      label {
        display: block;
        margin-top: 15px;
        font-weight: 600;
        color: #00c077;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      th {
        background: rgba(0, 192, 119, 0.2);
        color: #00e68a;
        font-weight: 600;
      }
      tr:hover {
        background: rgba(255, 255, 255, 0.02);
      }
      .link {
        color: #00c077;
        text-decoration: none;
        word-break: break-all;
      }
      .link:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üí∞ Money Flow Tracker</h1>
      <p>
        Track where all the KPGT went: donations ‚Üí platform fees ‚Üí campaign
        owner
      </p>

      <label>Campaign ID:</label>
      <input
        type="number"
        id="campaignId"
        value="0"
        placeholder="Enter campaign ID"
      />

      <label>Contract Address:</label>
      <input
        type="text"
        id="contractAddress"
        value="0x9c566de5f2ba01aabc707636caffa14b11079e19"
        placeholder="0x..."
      />

      <br /><br />
      <button onclick="trackMoneyFlow()">üîç Track Money Flow</button>

      <div id="result"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <script>
      const RPC_URL = "https://rpc1.paseo.mandalachain.io";
      const EXPLORER_URL = "https://explorer.mandalachain.io";

      let web3;
      let contract;

      window.addEventListener("load", async () => {
        if (window.ethereum) {
          web3 = new Web3(window.ethereum);
          await window.ethereum.enable();

          const contractAddress = "0x32d746F27890732a8a2ff821276b7225b8e469f9";
          const contractABI = [
            {
              inputs: [
                {
                  internalType: "address",
                  name: "_platformWallet",
                  type: "address",
                },
              ],
              stateMutability: "nonpayable",
              type: "constructor",
            },
            {
              anonymous: false,
              inputs: [
                {
                  indexed: true,
                  internalType: "uint256",
                  name: "campaignId",
                  type: "uint256",
                },
                {
                  indexed: false,
                  internalType: "string",
                  name: "title",
                  type: "string",
                },
                {
                  indexed: false,
                  internalType: "address",
                  name: "owner",
                  type: "address",
                },
                {
                  indexed: false,
                  internalType: "uint256",
                  name: "platformFee",
                  type: "uint256",
                },
              ],
              name: "CampaignCreated",
              type: "event",
            },
            {
              anonymous: false,
              inputs: [
                {
                  indexed: true,
                  internalType: "uint256",
                  name: "campaignId",
                  type: "uint256",
                },
              ],
              name: "CampaignFinished",
              type: "event",
            },
            {
              inputs: [
                {
                  internalType: "string",
                  name: "_title",
                  type: "string",
                },
                {
                  internalType: "string",
                  name: "_desc",
                  type: "string",
                },
                {
                  internalType: "string[]",
                  name: "_images",
                  type: "string[]",
                },
                {
                  internalType: "uint256",
                  name: "_goal",
                  type: "uint256",
                },
                {
                  internalType: "string",
                  name: "_ownerName",
                  type: "string",
                },
                {
                  internalType: "string",
                  name: "_contact",
                  type: "string",
                },
                {
                  internalType: "string",
                  name: "_category",
                  type: "string",
                },
                {
                  internalType: "address",
                  name: "_wallet",
                  type: "address",
                },
              ],
              name: "createCampaign",
              outputs: [],
              stateMutability: "nonpayable",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_id",
                  type: "uint256",
                },
              ],
              name: "donate",
              outputs: [],
              stateMutability: "payable",
              type: "function",
            },
            {
              anonymous: false,
              inputs: [
                {
                  indexed: true,
                  internalType: "uint256",
                  name: "campaignId",
                  type: "uint256",
                },
                {
                  indexed: false,
                  internalType: "address",
                  name: "donor",
                  type: "address",
                },
                {
                  indexed: false,
                  internalType: "uint256",
                  name: "amount",
                  type: "uint256",
                },
                {
                  indexed: false,
                  internalType: "uint256",
                  name: "platformFee",
                  type: "uint256",
                },
              ],
              name: "DonationReceived",
              type: "event",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_id",
                  type: "uint256",
                },
              ],
              name: "finishCampaign",
              outputs: [],
              stateMutability: "nonpayable",
              type: "function",
            },
            {
              anonymous: false,
              inputs: [
                {
                  indexed: true,
                  internalType: "uint256",
                  name: "campaignId",
                  type: "uint256",
                },
                {
                  indexed: true,
                  internalType: "address",
                  name: "to",
                  type: "address",
                },
                {
                  indexed: false,
                  internalType: "uint256",
                  name: "amount",
                  type: "uint256",
                },
              ],
              name: "FundsWithdrawn",
              type: "event",
            },
            {
              anonymous: false,
              inputs: [
                {
                  indexed: false,
                  internalType: "uint256",
                  name: "newFeePercent",
                  type: "uint256",
                },
              ],
              name: "PlatformFeeUpdated",
              type: "event",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_feePercent",
                  type: "uint256",
                },
              ],
              name: "updatePlatformFee",
              outputs: [],
              stateMutability: "nonpayable",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_id",
                  type: "uint256",
                },
              ],
              name: "withdrawFunds",
              outputs: [],
              stateMutability: "nonpayable",
              type: "function",
            },
            {
              inputs: [],
              name: "campaignCount",
              outputs: [
                {
                  internalType: "uint256",
                  name: "",
                  type: "uint256",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "",
                  type: "uint256",
                },
              ],
              name: "campaigns",
              outputs: [
                {
                  internalType: "uint256",
                  name: "id",
                  type: "uint256",
                },
                {
                  internalType: "string",
                  name: "title",
                  type: "string",
                },
                {
                  internalType: "string",
                  name: "description",
                  type: "string",
                },
                {
                  internalType: "uint256",
                  name: "goal",
                  type: "uint256",
                },
                {
                  internalType: "uint256",
                  name: "totalRaised",
                  type: "uint256",
                },
                {
                  internalType: "uint256",
                  name: "platformFee",
                  type: "uint256",
                },
                {
                  internalType: "string",
                  name: "ownerName",
                  type: "string",
                },
                {
                  internalType: "string",
                  name: "ownerContact",
                  type: "string",
                },
                {
                  internalType: "address",
                  name: "ownerWallet",
                  type: "address",
                },
                {
                  internalType: "bool",
                  name: "active",
                  type: "bool",
                },
                {
                  internalType: "bool",
                  name: "finished",
                  type: "bool",
                },
                {
                  internalType: "uint256",
                  name: "createdAt",
                  type: "uint256",
                },
                {
                  internalType: "string",
                  name: "category",
                  type: "string",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_offset",
                  type: "uint256",
                },
                {
                  internalType: "uint256",
                  name: "_limit",
                  type: "uint256",
                },
              ],
              name: "getActiveCampaignsPaginated",
              outputs: [
                {
                  components: [
                    {
                      internalType: "uint256",
                      name: "id",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "title",
                      type: "string",
                    },
                    {
                      internalType: "string",
                      name: "description",
                      type: "string",
                    },
                    {
                      internalType: "string[]",
                      name: "imageURLs",
                      type: "string[]",
                    },
                    {
                      internalType: "uint256",
                      name: "goal",
                      type: "uint256",
                    },
                    {
                      internalType: "uint256",
                      name: "totalRaised",
                      type: "uint256",
                    },
                    {
                      internalType: "uint256",
                      name: "platformFee",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "ownerName",
                      type: "string",
                    },
                    {
                      internalType: "string",
                      name: "ownerContact",
                      type: "string",
                    },
                    {
                      internalType: "address",
                      name: "ownerWallet",
                      type: "address",
                    },
                    {
                      internalType: "bool",
                      name: "active",
                      type: "bool",
                    },
                    {
                      internalType: "bool",
                      name: "finished",
                      type: "bool",
                    },
                    {
                      internalType: "uint256",
                      name: "createdAt",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "category",
                      type: "string",
                    },
                  ],
                  internalType: "struct Campaign[]",
                  name: "",
                  type: "tuple[]",
                },
                {
                  internalType: "uint256",
                  name: "total",
                  type: "uint256",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_offset",
                  type: "uint256",
                },
                {
                  internalType: "uint256",
                  name: "_limit",
                  type: "uint256",
                },
              ],
              name: "getAllCampaignsPaginated",
              outputs: [
                {
                  components: [
                    {
                      internalType: "uint256",
                      name: "id",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "title",
                      type: "string",
                    },
                    {
                      internalType: "string",
                      name: "description",
                      type: "string",
                    },
                    {
                      internalType: "string[]",
                      name: "imageURLs",
                      type: "string[]",
                    },
                    {
                      internalType: "uint256",
                      name: "goal",
                      type: "uint256",
                    },
                    {
                      internalType: "uint256",
                      name: "totalRaised",
                      type: "uint256",
                    },
                    {
                      internalType: "uint256",
                      name: "platformFee",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "ownerName",
                      type: "string",
                    },
                    {
                      internalType: "string",
                      name: "ownerContact",
                      type: "string",
                    },
                    {
                      internalType: "address",
                      name: "ownerWallet",
                      type: "address",
                    },
                    {
                      internalType: "bool",
                      name: "active",
                      type: "bool",
                    },
                    {
                      internalType: "bool",
                      name: "finished",
                      type: "bool",
                    },
                    {
                      internalType: "uint256",
                      name: "createdAt",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "category",
                      type: "string",
                    },
                  ],
                  internalType: "struct Campaign[]",
                  name: "",
                  type: "tuple[]",
                },
                {
                  internalType: "uint256",
                  name: "",
                  type: "uint256",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_id",
                  type: "uint256",
                },
              ],
              name: "getCampaign",
              outputs: [
                {
                  components: [
                    {
                      internalType: "uint256",
                      name: "id",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "title",
                      type: "string",
                    },
                    {
                      internalType: "string",
                      name: "description",
                      type: "string",
                    },
                    {
                      internalType: "string[]",
                      name: "imageURLs",
                      type: "string[]",
                    },
                    {
                      internalType: "uint256",
                      name: "goal",
                      type: "uint256",
                    },
                    {
                      internalType: "uint256",
                      name: "totalRaised",
                      type: "uint256",
                    },
                    {
                      internalType: "uint256",
                      name: "platformFee",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "ownerName",
                      type: "string",
                    },
                    {
                      internalType: "string",
                      name: "ownerContact",
                      type: "string",
                    },
                    {
                      internalType: "address",
                      name: "ownerWallet",
                      type: "address",
                    },
                    {
                      internalType: "bool",
                      name: "active",
                      type: "bool",
                    },
                    {
                      internalType: "bool",
                      name: "finished",
                      type: "bool",
                    },
                    {
                      internalType: "uint256",
                      name: "createdAt",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "category",
                      type: "string",
                    },
                  ],
                  internalType: "struct Campaign",
                  name: "",
                  type: "tuple",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [],
              name: "getContractBalance",
              outputs: [
                {
                  internalType: "uint256",
                  name: "",
                  type: "uint256",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_id",
                  type: "uint256",
                },
              ],
              name: "getDonationCount",
              outputs: [
                {
                  internalType: "uint256",
                  name: "",
                  type: "uint256",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_id",
                  type: "uint256",
                },
              ],
              name: "getDonations",
              outputs: [
                {
                  components: [
                    {
                      internalType: "address",
                      name: "donor",
                      type: "address",
                    },
                    {
                      internalType: "uint256",
                      name: "amount",
                      type: "uint256",
                    },
                    {
                      internalType: "uint256",
                      name: "timestamp",
                      type: "uint256",
                    },
                  ],
                  internalType: "struct Donation[]",
                  name: "",
                  type: "tuple[]",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_offset",
                  type: "uint256",
                },
                {
                  internalType: "uint256",
                  name: "_limit",
                  type: "uint256",
                },
              ],
              name: "getFinishedCampaignsPaginated",
              outputs: [
                {
                  components: [
                    {
                      internalType: "uint256",
                      name: "id",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "title",
                      type: "string",
                    },
                    {
                      internalType: "string",
                      name: "description",
                      type: "string",
                    },
                    {
                      internalType: "string[]",
                      name: "imageURLs",
                      type: "string[]",
                    },
                    {
                      internalType: "uint256",
                      name: "goal",
                      type: "uint256",
                    },
                    {
                      internalType: "uint256",
                      name: "totalRaised",
                      type: "uint256",
                    },
                    {
                      internalType: "uint256",
                      name: "platformFee",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "ownerName",
                      type: "string",
                    },
                    {
                      internalType: "string",
                      name: "ownerContact",
                      type: "string",
                    },
                    {
                      internalType: "address",
                      name: "ownerWallet",
                      type: "address",
                    },
                    {
                      internalType: "bool",
                      name: "active",
                      type: "bool",
                    },
                    {
                      internalType: "bool",
                      name: "finished",
                      type: "bool",
                    },
                    {
                      internalType: "uint256",
                      name: "createdAt",
                      type: "uint256",
                    },
                    {
                      internalType: "string",
                      name: "category",
                      type: "string",
                    },
                  ],
                  internalType: "struct Campaign[]",
                  name: "",
                  type: "tuple[]",
                },
                {
                  internalType: "uint256",
                  name: "total",
                  type: "uint256",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "_amount",
                  type: "uint256",
                },
              ],
              name: "getPlatformFeeForAmount",
              outputs: [
                {
                  internalType: "uint256",
                  name: "",
                  type: "uint256",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [],
              name: "getPlatformFeePercent",
              outputs: [
                {
                  internalType: "uint256",
                  name: "",
                  type: "uint256",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [
                {
                  internalType: "uint256",
                  name: "",
                  type: "uint256",
                },
              ],
              name: "pendingWithdrawals",
              outputs: [
                {
                  internalType: "uint256",
                  name: "",
                  type: "uint256",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [],
              name: "platformFeePercent",
              outputs: [
                {
                  internalType: "uint256",
                  name: "",
                  type: "uint256",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
            {
              inputs: [],
              name: "platformWallet",
              outputs: [
                {
                  internalType: "address",
                  name: "",
                  type: "address",
                },
              ],
              stateMutability: "view",
              type: "function",
            },
          ];

          contract = new web3.eth.Contract(contractABI, contractAddress);
          console.log("‚úÖ Contract loaded:", contractAddress);
        } else {
          alert("Please install MetaMask to use this tracker.");
        }
      });

      async function trackMoneyFlow() {
        try {
          const campaignId = document.getElementById("campaignId").value;
          if (!campaignId) {
            alert("Please enter a campaign ID first.");
            return;
          }

          console.log("Tracking campaign:", campaignId);

          const campaign = await contract.methods.campaigns(campaignId).call();
          console.log("Campaign data:", campaign);

          const platformWallet = await contract.methods.platformWallet().call();
          console.log("Platform wallet:", platformWallet);

          alert(
            `Campaign ${campaignId} tracked!\nOwner: ${campaign.owner}\nRaised: ${campaign.totalRaised}\nGoal: ${campaign.goal}`
          );
        } catch (error) {
          console.error("Error tracking money flow:", error);
          alert("Error tracking money flow. Check console for details.");
        }
      }
    </script>
  </body>
</html>
